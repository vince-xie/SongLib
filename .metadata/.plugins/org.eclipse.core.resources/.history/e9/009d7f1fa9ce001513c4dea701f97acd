package controller;

import java.io.*;
import java.net.URL;
import java.util.*;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.ListView;
import javafx.scene.control.TextInputDialog;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.text.Text;
import javafx.stage.Stage;
import model.SongList;
import view.SongInputDialog;


public class ListController implements Initializable {
	@FXML         
	   ListView<String> listView; 
	@FXML
       private ImageView imageView;
	@FXML
	   private Text name;

	   private ObservableList<String> obsList;     
	   private SongList songList;
	  
	   public void start(Stage mainStage) {                
	      // create an ObservableList 
	      // from an ArrayList          
		  songList = new SongList();
	      obsList = FXCollections.observableArrayList();               
	      listView.setItems(obsList); 
	      
	      // select the first item
	      listView.getSelectionModel().select(0);

	      // set listener for the items
	      listView
	      .getSelectionModel()
	      .selectedItemProperty()
	      .addListener(
	    		  (obs, oldVal, newVal) -> 
	    		  showItemInputDialog(mainStage));
	   }
	   
	   public void addSong(ActionEvent e) {
		   SongInputDialog dlg = new SongInputDialog("Add Song");
		   dlg.setContentText("Song name: ");
		   
		   dlg.showAndWait();
		   String song = dlg.getSongText(), artist = dlg.getArtistText(), album = dlg.getAlbumText(), year = dlg.getYearText();
		   int intyear = 0;
		   if (song.isEmpty() || artist.isEmpty()) {
			   Alert error = new Alert(AlertType.INFORMATION);
			   error.setHeaderText("Error!");
			   error.setContentText("Either artist or song name is missing!");
			   error.show();
			   return;
		   }
		   else {
			   if (!year.isEmpty()) {
				   try {
					   intyear = Integer.parseInt(year);
					   if(intyear < 0){
						   Alert error = new Alert(AlertType.INFORMATION);
						   error.setHeaderText("Error!");
						   error.setContentText("Year is invalid!");
						   error.show();
						   return;
					   }
				   } catch (Exception ex) {
					   Alert error = new Alert(AlertType.INFORMATION);
					   error.setHeaderText("Error!");
					   error.setContentText("Year is invalid!");
					   error.show();
					   return;
				   }
			   } else {
				   
			   }
		   }
		   //Make song and artist required while album and year are optional
		   System.out.println(song + " " + artist + " " + album + " " + intyear);
		   int index = songList.addSongToList(song, album, artist, intyear);
		   obsList.add(index, song);
	   }
	   
	   public void removeItem(ActionEvent e){
		   
	   }
	   
	   private void showItem(Stage mainStage) {                
		   Alert alert = new Alert(AlertType.INFORMATION);
		   alert.initOwner(mainStage);
		   alert.setTitle("List Item");
		   alert.setHeaderText(
				   "Selected list item properties");

		   String content = "Index: " + 
				   listView.getSelectionModel()
		   .getSelectedIndex() + 
		   "\nValue: " + 
		   listView.getSelectionModel()
		   .getSelectedItem();

		   alert.setContentText(content);
		   alert.showAndWait();
	   }
	   
	   private void showItemInputDialog(Stage mainStage) {                
		   String item = listView.getSelectionModel().getSelectedItem();
		   int index = listView.getSelectionModel().getSelectedIndex();

		   TextInputDialog dialog = new TextInputDialog(item);
		   dialog.initOwner(mainStage); dialog.setTitle("List Item");
		   dialog.setHeaderText("Selected Item (Index: " + index + ")");
		   dialog.setContentText("Enter name: ");

		   Optional<String> result = dialog.showAndWait();
		   if (result.isPresent()) { obsList.set(index, result.get()); }
	   }

	    @Override
	    public void initialize(URL location, ResourceBundle resources) {
	        File file = new File("src/album.png");
	        Image image = new Image(file.toURI().toString());
	        imageView.setImage(image);
	    }
}
